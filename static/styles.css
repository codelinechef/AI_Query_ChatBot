/* ===== Theme variables + brand ========================================== */
:root {
  --accent-primary: #4E9CF5;
  --accent-secondary: #6C63FF;
  --accent-gradient: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));

  --bg: #f9fafc;
  --bg-alt: #ffffff;
  --text: #1c1c28;
  --text-dim: #57606a;
  --accent: var(--accent-primary);
  --accent-2: var(--accent-secondary);
  --card: #ffffff;
  --border: #e6e6f0;
  --success: #16a34a;

  --bg-image-opacity: 0.30;
  --bg-image-filter: saturate(1.1) brightness(1.12) contrast(1.08);

  --dur-fast: 160ms; --dur-med: 280ms; --dur-slow: 480ms;
}

html[data-theme="dark"] {
  --bg: #1E1E2E;
  --bg-alt: #2C2C3F;
  --text: #e6e6f0;
  --text-dim: #a2a2bb;
  --accent: var(--accent-primary);
  --accent-2: var(--accent-secondary);
  --card: #202036;
  --border: #2e2e48;
  --success: #22c55e;

  --bg-image-opacity: 0.25;
  --bg-image-filter: saturate(1.2) brightness(0.85) contrast(1.25);
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  scroll-behavior: smooth;
  overflow-x: hidden;
  perspective: 1200px;
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
  color: var(--text);
  background:
    radial-gradient(1200px 600px at 20% 0%, color-mix(in oklab, var(--accent) 12%, transparent), transparent 40%),
    radial-gradient(800px 400px at 80% 10%, color-mix(in oklab, var(--accent-2) 10%, transparent), transparent 50%),
    linear-gradient(180deg, var(--bg) 0%, var(--bg-alt) 100%);
  transition: background var(--dur-fast) ease;
}

/* Galaxy wallpaper parallax base */
:root { --bg-pos-x: 50%; --bg-pos-y: 50%; }
body::before {
  content: "";
  position: fixed; inset: 0;
  background: url("/images/Interstellar%20wallpaper%204k.jpg") center / cover no-repeat;
  background-position: var(--bg-pos-x) var(--bg-pos-y);
  opacity: var(--bg-image-opacity);
  filter: var(--bg-image-filter);
  z-index: -2;
}
body::after {
  content: "";
  position: fixed; inset: 0;
  background: radial-gradient(1000px 500px at 15% 0%, color-mix(in oklab, var(--bg-alt) 30%, transparent), transparent 40%),
              radial-gradient(900px 400px at 85% 10%, color-mix(in oklab, var(--bg) 22%, transparent), transparent 50%);
  z-index: -1;
}

/* App layout */
.app { display: grid; grid-template-rows: auto auto 1fr auto; min-height: 100vh; perspective: 1000px; }
.header {
  display:flex; align-items:center; justify-content:space-between;
  padding: 12px 16px; border-bottom:1px solid var(--border);
  background: color-mix(in oklab, var(--bg-alt) 60%, transparent);
  backdrop-filter: blur(1px);
}
.brand { display:flex; align-items:center; gap:10px; }
.brand h1 { font-size: 16px; margin:0; font-weight:600; }
.dot { width:10px; height:10px; border-radius:50%; background: var(--accent-gradient); animation: glow 3s ease-in-out infinite; }

.header-actions { display:flex; align-items:center; gap:10px; }
.status { font-size:12px; color: var(--text-dim); }

.toggle {
  display:inline-flex; align-items:center; justify-content:center;
  width:36px; height:32px; border-radius:8px;
  border:1px solid var(--border);
  background: var(--card);
  color: var(--text); cursor:pointer;
}
.toggle:active { transform: translateY(1px); }

.quick-replies { display:flex; gap:8px; flex-wrap:wrap; padding:8px 16px; border-top:1px solid var(--border); margin-top: 6px; }
.chip {
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 10px; border-radius:999px;
  background: var(--card); border:1px solid var(--border);
  color: var(--text); font-size:12px; cursor:pointer;
  transition: transform var(--dur-fast) ease, box-shadow var(--dur-fast) ease, border-color var(--dur-fast);
}
.chip:hover { transform: translateZ(4px) scale(1.02);
  border-color: color-mix(in oklab, var(--accent) 40%, var(--border));
  box-shadow: 0 8px 22px rgba(0,0,0,0.15);
}

/* Chat shell */
.chat-shell {
  width:100%; max-width:940px; margin:32px auto;
  border:1px solid var(--border); border-radius:16px;
  background: color-mix(in oklab, var(--bg-alt) 65%, transparent);
  backdrop-filter: blur(1px);
  box-shadow: 0 18px 40px rgba(0,0,0,0.18), 0 2px 6px rgba(0,0,0,0.08);
  transform-style: preserve-3d;
  transition: transform var(--dur-fast) ease, box-shadow var(--dur-fast) ease;
}
.chat-shell:hover { box-shadow: 0 24px 60px rgba(0,0,0,0.22); }
.chat { padding:16px; overflow-y:auto; max-height: 70vh; }
.messages { max-width:820px; margin:0 auto; display:flex; flex-direction:column; gap:12px; }

/* Messages */
.msg { display:flex; gap:10px; align-items: flex-start; }
.msg .avatar { width:36px; height:36px; border-radius:50%; background: var(--accent-gradient); flex-shrink: 0; box-shadow: 0 2px 6px rgba(0,0,0,0.12); }
.msg.assistant .avatar { background: url('/images/logo.png') center / cover no-repeat; border: 1px solid var(--border); }
.msg .bubble {
  padding:12px 14px; border-radius:12px; line-height:1.5;
  background: var(--card); border:1px solid var(--border);
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  transition: background-color var(--dur-fast) ease, border-color var(--dur-fast) ease;
  backdrop-filter: blur(1px);
}
.msg.user .bubble { border-color: color-mix(in oklab, var(--accent-2) 35%, var(--border)); animation: userIn 240ms cubic-bezier(.2,.8,.2,1); }
.msg.assistant .bubble { border-color: color-mix(in oklab, var(--accent) 35%, var(--border)); animation: botIn 260ms cubic-bezier(.2,.8,.2,1); }
.msg.assistant.thinking .bubble { opacity: .85; }
/* Structured content styling */
.msg .bubble h2 { font-size: 1rem; margin: 0 0 6px; font-weight: 700; }
.msg .bubble h3 { font-size: 0.95rem; margin: 0 0 6px; font-weight: 700; }
.msg .bubble h4 { font-size: 0.9rem; margin: 0 0 6px; font-weight: 700; }
.msg .bubble p { margin: 6px 0; }
.msg .bubble ul, .msg .bubble ol { margin: 6px 0 6px 18px; padding: 0; }
.msg .bubble li { margin: 4px 0; }
.meta { font-size:12px; color: var(--text-dim); margin-bottom:6px; }

@keyframes userIn { 0%{ transform: translateY(10px) translateX(8px); opacity:0 } 100%{ transform:none; opacity:1 } }
@keyframes botIn { 0%{ transform: translateY(6px) scale(.98); opacity:0 } 100%{ transform:none; opacity:1 } }

/* Typing indicator */
.typing { display:inline-flex; align-items:center; gap:6px; }
.typing .dot {
  width:6px; height:6px; border-radius:50%;
  background: color-mix(in oklab, var(--accent) 60%, var(--accent-2));
  animation: typingDot 1000ms ease-in-out infinite;
}
.typing .dot:nth-child(2){ animation-delay:.15s }
.typing .dot:nth-child(3){ animation-delay:.3s }
@keyframes typingDot { 0%,100%{ transform: translateY(0); opacity:.6 } 50%{ transform: translateY(-4px); opacity:1 } }

/* Composer */
.composer { padding:12px 16px; border-top:1px solid var(--border);
  background: color-mix(in oklab, var(--bg-alt) 60%, transparent); backdrop-filter: blur(1px); }
#chat-form { display:flex; gap:8px; max-width:820px; margin:0 auto; }
.input-wrap { position:relative; flex:1; }
.input-tag {
  position:absolute; left:12px; top:50%; transform: translateY(-50%);
  font-size:12px; font-weight:600; background: var(--accent-gradient);
  -webkit-background-clip:text; background-clip:text; color: transparent; pointer-events: none;
}
#chat-input {
  flex:1; padding:10px 12px 10px 120px; border-radius:10px; border:1px solid var(--border);
  background: color-mix(in oklab, var(--card) 85%, transparent); color: var(--text);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0,0,0,0.12), 0 2px 6px rgba(0,0,0,0.08);
  transition: transform var(--dur-fast), box-shadow var(--dur-fast), border-color var(--dur-fast);
}
#chat-input:focus {
  outline:none; border-color: color-mix(in oklab, var(--accent) 0%, var(--border)); transform: translateZ(8px);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.08), 0 14px 28px rgba(0,0,0,0.16), 0 3px 10px rgba(0,0,0,0.10);
}
#send-btn {
  padding:10px 14px; border-radius:10px; border:1px solid var(--border);
  background: var(--accent-gradient); color:white; font-weight:600; cursor:pointer;
}

/* Code blocks inside assistant messages */
.msg .bubble pre, .msg .bubble code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 0.9rem;
}
.msg .bubble pre {
  background: color-mix(in oklab, var(--card) 88%, transparent);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 12px;
  overflow: auto;
}
.copy-btn {
  display:inline-flex; align-items:center; gap:6px; font-size: 12px;
  border:1px solid var(--border); border-radius: 8px;
  padding: 4px 8px; background: var(--card); cursor: pointer;
  margin-top: 6px;
}

/* Parallax mid blobs */
#parallax-mid { position: fixed; inset: 0; pointer-events: none; z-index: -1; }
#parallax-mid .blob {
  position: absolute; width: 220px; height: 220px; border-radius: 50%;
  background: var(--accent-gradient); filter: blur(24px) saturate(120%); opacity: 0.20;
  animation: blobFloat 12s ease-in-out infinite; transform: translate3d(var(--mid-x,0), var(--mid-y,0), 0);
}
#parallax-mid .b1 { top: 10%; left: 12%; animation-duration: 15s; }
#parallax-mid .b2 { top: 60%; left: 18%; animation-duration: 18s; }
#parallax-mid .b3 { top: 30%; right: 10%; animation-duration: 16s; }
@keyframes blobFloat { 0%,100% { transform: translate3d(var(--mid-x,0), var(--mid-y,0), 0) scale(1) } 50% { transform: translate3d(var(--mid-x,0), calc(var(--mid-y,0) - 12px), 0) scale(1.06) } }

/* Tilt utility */
.tilt { transform-style: preserve-3d; will-change: transform; }

/* Ripple */
.ripple-wrap { position: relative; overflow: hidden; }
.ripple {
  position:absolute; border-radius:50%; background: var(--accent-gradient);
  transform: scale(0); opacity:.5; animation: ripple 600ms ease-out forwards;
}
@keyframes ripple { to { transform: scale(12); opacity: 0; } }

/* Footer runner */
.footer-runner { position: fixed; left:0; right:0; bottom:0; height: 72px; display:flex; align-items:center; gap:12px; padding:0 16px; z-index:40; pointer-events:none; }
.footer-runner .ground {
  flex:1; height:2px; opacity: .35;
  background: repeating-linear-gradient(90deg, var(--text-dim), var(--text-dim) 24px, transparent 24px, transparent 48px);
  animation: groundScroll 3s linear infinite;
}
@keyframes groundScroll { 0% { background-position-x: 0px } 100% { background-position-x: -240px } }
.footer-runner .runner { width:72px; height:48px; filter: drop-shadow(0 6px 16px rgba(0,0,0,0.25)); pointer-events:auto; }
.footer-runner .runner svg { width:100%; height:100%; }
.footer-runner .runner .leg-left { transform-origin:18px 32px; animation: legRun 400ms ease-in-out infinite; }
.footer-runner .runner .leg-right { transform-origin:54px 32px; animation: legRun 400ms ease-in-out infinite reverse; }
.footer-runner .runner.jump { animation: jump 480ms cubic-bezier(.2,.8,.2,1); }
@keyframes legRun { 0%,100% { transform: rotate(12deg) } 50% { transform: rotate(-18deg) } }
@keyframes jump { 0%,100% { transform: translateY(0) } 40% { transform: translateY(-18px) } }
html[data-theme="dark"] .footer-runner .runner * { fill: #e6e6f0; }
html[data-theme="light"] .footer-runner .runner * { fill: #2C2C3F; }

/* Prefers reduced motion */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after { animation: none !important; transition: none !important; }
  #parallax-mid, body::before { display: none !important; }
}

/* Responsiveness */
@media (max-width: 1024px) { .messages, #chat-form { max-width: 760px } }
@media (max-width: 768px) {
  .header { padding: 10px 12px }
  .chat { padding: 10px }
  #chat-form { padding-bottom: 4px }
  .chat-shell { margin: 12px auto }
  #parallax-mid .blob { opacity: .16; filter: blur(20px) }
}
@media (max-width: 480px) {
  .brand h1 { font-size: 14px }
  .toggle { width: 34px; height: 30px }
  .chip { font-size: 11px; padding: 5px 8px }
  #chat-input { padding-left: 96px }
  .input-tag { font-size: 11px }
}

/* Utilities */
.hidden { display:none !important; }
@keyframes glow { 0%,100% { box-shadow: 0 0 20px color-mix(in oklab, var(--accent) 40%, transparent) } 50% { box-shadow: 0 0 28px color-mix(in oklab, var(--accent-2) 55%, transparent) } }

/* Custom scrollbars (WebKit) */
.chat::-webkit-scrollbar { width: 10px; }
.chat::-webkit-scrollbar-thumb { background: color-mix(in oklab, var(--bg-alt) 25%, var(--text-dim)); border-radius: 10px; }

/* ================= MODAL (Enhanced with 3D Parallax + Glow) ================= */
.modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(8px);
  z-index: 999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 300ms ease;
  perspective: 1200px;
}

.modal:not(.hidden) {
  opacity: 1;
  pointer-events: auto;
}

/* Core modal card */
.modal-card {
  position: relative;
  background: color-mix(in oklab, var(--card) 95%, transparent);
  border-radius: 24px;
  padding: 32px 36px;
  max-width: 500px;
  width: 90%;
  border: 1px solid var(--border);
  box-shadow:
    0 28px 60px rgba(0,0,0,0.35),
    0 8px 16px rgba(0,0,0,0.18),
    inset 0 0 80px rgba(255,255,255,0.04);
  transform-style: preserve-3d;
  animation: modalPop 0.5s cubic-bezier(.2,.8,.3,1) forwards;
  will-change: transform, box-shadow;
}

@keyframes modalPop {
  0% { opacity: 0; transform: scale(0.8) translateY(60px) rotateX(10deg); }
  100% { opacity: 1; transform: scale(1) translateY(0) rotateX(0); }
}

/* Internal glowing aura */
.modal-card::before, .modal-card::after {
  content: "";
  position: absolute;
  inset: -20%;
  border-radius: inherit;
  background: radial-gradient(circle at 50% 50%, var(--accent-gradient), transparent 70%);
  filter: blur(40px);
  opacity: 0.15;
  z-index: -1;
  transform: translateZ(-40px) scale(1.2);
}

/* Background glow layer */
.modal-glow {
  position: absolute;
  inset: 0;
  background: radial-gradient(circle at 50% 60%, var(--accent-gradient), transparent 70%);
  filter: blur(80px);
  opacity: 0.15;
  z-index: -2;
}

/* Close button */
.modal-close {
  position: absolute;
  top: 12px; right: 16px;
  background: none;
  border: none;
  font-size: 24px;
  color: var(--text);
  cursor: pointer;
  transition: transform 0.2s ease, color 0.3s;
  z-index: 2;
}
.modal-close:hover {
  transform: rotate(90deg) scale(1.2);
  color: var(--accent);
}

/* Header section */
.modal-header {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 16px;
}

/* Avatar — now uses the background image but keeps spinning glow */
.modal-header .avatar.galaxy {
  width: 64px; height: 64px;
  border-radius: 50%;
  background: var(--accent-gradient);
  background-blend-mode: overlay;
  box-shadow: 0 0 32px rgba(0,0,0,0.3), 0 0 12px var(--accent);
  animation: spinGalaxy 8s linear infinite;
  transform-style: preserve-3d;
  border: 2px solid color-mix(in oklab, var(--accent) 50%, transparent);
}

@keyframes spinGalaxy {
  0% { transform: rotateY(0deg); }
  100% { transform: rotateY(360deg); }
}

/* Floating “About” pill */
.about-pill {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 999px;
  background: var(--accent-gradient);
  color: white;
  font-weight: 600;
  font-size: 12px;
  letter-spacing: 0.4px;
  margin-bottom: 14px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  animation: floatUpDown 3s ease-in-out infinite;
}

@keyframes floatUpDown {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

/* Modal body text */
.modal-body {
  color: var(--text-dim);
  font-size: 0.95rem;
  line-height: 1.6;
  transform: translateZ(20px);
}

.modal-body .links {
  display: flex;
  gap: 14px;
  margin-top: 14px;
}

.modal-body .links a {
  text-decoration: none;
  color: var(--accent);
  font-weight: 600;
  transition: color var(--dur-fast), transform var(--dur-fast), text-shadow 0.3s ease;
}

.modal-body .links a:hover {
  color: var(--accent-2);
  transform: translateY(-2px);
  text-shadow: 0 0 8px color-mix(in oklab, var(--accent) 60%, transparent);
}

/* 3D tilt effect (modal specific) */
.modal-card.tilt-3d {
  transition: transform 0.2s ease-out, box-shadow 0.3s ease;
  will-change: transform;
}
/* ================== ULTRA PREMIUM MODAL ================== */
.modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(10, 10, 25, 0.65);
  backdrop-filter: blur(14px) saturate(140%);
  -webkit-backdrop-filter: blur(14px) saturate(140%);
  z-index: 999;
  opacity: 0;
  pointer-events: none;
  transition: opacity 400ms cubic-bezier(.25,.1,.25,1);
  perspective: 1800px;
}

.modal:not(.hidden) {
  opacity: 1;
  pointer-events: auto;
}

/* Glass + Glow Card */
.modal-card {
  position: relative;
  background: color-mix(in oklab, var(--card) 95%, transparent);
  border-radius: 28px;
  padding: 40px 48px;
  max-width: 520px;
  width: 92%;
  border: 1px solid color-mix(in oklab, var(--accent) 35%, var(--border));
  box-shadow:
    0 25px 60px rgba(0,0,0,0.5),
    inset 0 0 120px rgba(255,255,255,0.04);
  transform-style: preserve-3d;
  animation: modalEnter 0.7s cubic-bezier(.2,.8,.3,1) forwards;
  overflow: hidden;
  isolation: isolate;
}

@keyframes modalEnter {
  0% {
    opacity: 0;
    transform: translateY(80px) scale(0.8) rotateX(10deg);
    filter: blur(8px);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1) rotateX(0);
    filter: blur(0);
  }
}

/* Dynamic glow gradients */
.modal-card::before,
.modal-card::after {
  content: "";
  position: absolute;
  inset: -40%;
  background: radial-gradient(
    circle at var(--mx, 50%) var(--my, 50%),
    color-mix(in oklab, var(--accent-primary) 60%, transparent),
    transparent 70%
  );
  filter: blur(80px);
  opacity: 0.2;
  transition: opacity 0.3s ease, transform 0.3s ease;
  z-index: -1;
}
.modal-card:hover::before { opacity: 0.35; transform: scale(1.1); }

/* Animated highlight border */
.modal-card::after {
  inset: -2px;
  border-radius: inherit;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  opacity: 0.08;
  filter: blur(12px);
  mask: linear-gradient(white, transparent 70%);
  -webkit-mask: linear-gradient(white, transparent 70%);
}

/* Avatar with cosmic glow */
.modal-header .avatar.galaxy {
  width: 72px; height: 72px;
  border-radius: 50%;
  background-image: url('/images/about_avatar.png'), radial-gradient(circle, var(--accent-primary), var(--accent-secondary));
  background-size: cover;
  background-position: center;
  box-shadow:
    0 0 0 2px color-mix(in oklab, var(--accent-2) 40%, transparent),
    0 0 20px rgba(0,0,0,0.4),
    0 0 40px var(--accent-primary);
  position: relative;
  animation: spinGalaxy 10s linear infinite;
}
.modal-header .avatar.galaxy::after {
  content: "";
  position: absolute;
  inset: -10%;
  border-radius: inherit;
  background: conic-gradient(from 0deg, var(--accent-primary), var(--accent-secondary), var(--accent-primary));
  filter: blur(12px);
  opacity: 0.3;
  animation: glowRotate 6s linear infinite;
}
@keyframes glowRotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Floating “About” pill */
.about-pill {
  display: inline-block;
  padding: 6px 18px;
  border-radius: 999px;
  background: var(--accent-gradient);
  color: white;
  font-weight: 700;
  font-size: 13px;
  letter-spacing: 0.4px;
  text-transform: uppercase;
  margin-bottom: 16px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.3);
  animation: floatUpDown 3s ease-in-out infinite;
}
@keyframes floatUpDown {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-8px); }
}

/* Text + Links */
.modal-body {
  color: var(--text-dim);
  font-size: 0.97rem;
  line-height: 1.7;
  transform: translateZ(20px);
  margin-top: 6px;
}

.modal-body .links {
  display: flex;
  gap: 18px;
  margin-top: 18px;
}

.modal-body .links a {
  position: relative;
  text-decoration: none;
  color: var(--accent);
  font-weight: 700;
  transition: color 0.3s ease;
}

.modal-body .links a::after {
  content: "";
  position: absolute;
  bottom: -3px; left: 0;
  width: 100%; height: 2px;
  background: var(--accent-gradient);
  transform: scaleX(0);
  transform-origin: right;
  transition: transform 0.3s ease;
}
.modal-body .links a:hover::after {
  transform: scaleX(1);
  transform-origin: left;
}
.modal-body .links a:hover {
  color: var(--accent-2);
}

/* Close button */
.modal-close {
  position: absolute;
  top: 16px; right: 20px;
  background: none;
  border: none;
  font-size: 24px;
  color: var(--text);
  cursor: pointer;
  transition: transform 0.25s ease, color 0.25s ease;
}
.modal-close:hover {
  transform: rotate(90deg) scale(1.2);
  color: var(--accent-primary);
}

/* Enhanced 3D Tilt */
.modal-card.tilt-3d {
  transition: transform 0.2s ease-out, box-shadow 0.4s ease;
  will-change: transform, box-shadow;
}
